---
layout: post
title:  "AutoColorization: Pink taskbar and title bar when using Hybrid profile and Active Setup (Windows 2012 R2 and Windows 8.1)"
date:   2016-04-22 12:04:00 +0100
categories:  Windows 2012 R2, RES One Workspace, XenDesktop, Windows 8.1, RES, Auto Color taskbar, AutoColorization, Group Policy Preferences, Auto Color title bar, XenApp
---

A customer, which has a red and white color logo, got a pink taskbar and title bars after applying a new background on their Windows 2012 R2 Session Hosts. This pink color is generated by default due to the Auto Color in the users taskbar and title bar color personalization setting. In the registry this is called AutoColorization. AutoColorization pics an average color of you background image. In case of this customer red and white makes pink. The customer doesn’t like a pink taskbar for 500+ users, so they decided that it needs to be blue. When using Local Profiles with RES One Workpace Zero Profile mode, this doesn’t work out of the box. Because we are using Local Profiles combined with RES One Workspace Zero profile mode, every time the user logs in the Active Setup is started for themes. The Active Setup is resetting the registry settings for AutoColorization and the color we’ve picked (DWM). We need this active setup at login!  
  
The registry keys for setting the taskbar and title bars to blue:  
\---------------------------------------------------------  
_Windows Registry Editor Version 5.00_  
  
_\[HKEY\_CURRENT\_USER\\Control Panel\\Desktop\]  
"AutoColorization"=dword:00000000_  
  
_\[HKEY\_CURRENT\_USER\\Software\\Microsoft\\Windows\\DWM\]  
"ColorizationAfterglow"=dword:c484c6ff  
"ColorizationAfterglowBalance"=dword:0000000a  
"ColorizationBlurBalance"=dword:00000001  
"ColorizationColor"=dword:c484c6ff  
"ColorizationColorBalance"=dword:00000059  
"ColorizationGlassAttribute"=dword:00000000  
"Composition"=dword:00000001  
"EnableWindowColorization"=dword:00000001_  
\---------------------------------------------------------  
  
With RES One Workspace it is impossible to set the color behavior properly by using the “User Registry” settings. When applying the correct keys to RES User Registry Settings only, the color of the taskbar and titlebar is changing every session (white, gray, black, etc.) I’ve figured out that the workspace composer isn’t messing these registry keys, but the enabled Active Setup is.  
  
To set a solid color properly, please configure the registry keys as follows:  
  
1\. Open your Active Directory Session Host User Policy and add the registry keys to the Group Policy Preference (this applies the registry keys before the RES Composer and Active Setup)  

[![]({{ site.url }}/images/2016-04-22/2016-04-22-image001.png)](https://1.bp.blogspot.com/-iKoQRilcV6s/Vxny68rfNiI/AAAAAAAAAW4/95PnpetbwpUcSKDdGT3FrlyReH3KYoxrACKgB/s1600/image001.png)

  
 2. Apply the registry keys again with RES One Workspace User Registry (this applies the registry keys after the Active Setup)  

[![]({{ site.url }}/images/2016-04-22/2016-04-22-image002.png)](https://4.bp.blogspot.com/-C09Wui0ahtM/Vxny68TWmiI/AAAAAAAAAW4/_O8FF5B31Mc-wDt5QCbTZFTVsslIyQJWgCKgB/s1600/image002.png)

  
3\. Bam, solid blue for every user!  
  
If you want another color like orange. Just configure orange in and Admin session and capture the right DWM values for orange.